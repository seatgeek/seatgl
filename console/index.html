<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Language" content="en" />
</head>
<body>

<style type="text/css">
.console {
  width: 640px
}
</style>

<div class="console">
  
</div>

<script src="/vendor/stats.js"></script>
<script src="/vendor/underscore.js"></script>
<script src="/vendor/zepto.js"></script>
<script>

function Console (domElement) {
  this.domElement = domElement;
}

Console.prototype.initialize = function () {
  this._initStats();
  this._startLoop();
  this._openConnection();
};

Console.prototype._startLoop = function () {
  var that = this;
  function render() {
  	requestAnimationFrame(render);
    if (that.stats) {
      that.stats.update();
    }
  }
  render();
};

Console.prototype._openConnection = function () {
  this.socket = new WebSocket("ws://localhost:5000/consolesocket");
  this.socket.onmessage = _.bind(this._onMessage, this);
};

Console.prototype._onMessage = function (msg) {
  try {
    msg = JSON.parse(msg.data);
  } catch (e) {
    console.log("Bad message:", msg);
    return;
  }
  console.log(msg)
  this._renderDebug(msg.data);
};

Console.prototype._renderDebug = function (data) {
  var pre = 2;
  this.domElement.innerHTML = "acc: " + data.motion.acceleration.x.toFixed(pre) + ", " + data.motion.acceleration.y.toFixed(pre) + ", " + data.motion.acceleration.z.toFixed(pre) +
                              "<br>" +
                              "rot: " + data.motion.rotationRate.alpha.toFixed(pre) + ", " + data.motion.rotationRate.beta.toFixed(pre) + ", " + data.motion.rotationRate.gamma.toFixed(pre) +
                              "<br>" +
                              "int: " + data.motion.interval.toFixed(pre) +
                              "<br>" +
                              "alp: " + data.orientation.alpha.toFixed(pre) + " | " +
                              "bet: " + data.orientation.beta.toFixed(pre) + " | " +
                              "gam: " + data.orientation.gamma.toFixed(pre);
};

Console.prototype._initStats = function () {
  this.stats = new Stats();
  // 0: fps, 1: ms
  this.stats.setMode(0);
  this.stats.domElement.style.cssText = 'position: absolute; right: 0; top: 0';
  document.body.appendChild(this.stats.domElement);
};

</script>

<script>

var game = new Console($(".console")[0]);
game.initialize();

</script>

</body>
</html>
